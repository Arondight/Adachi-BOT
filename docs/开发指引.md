# 开发指引

## 目录结构

```
Adachi-BOT
├── app.js                      # 主程序
├── config
│   ├── artifacts.yml           # 圣遗物配置
│   ├── command.yml             # 命令入口
├── data
│   ├── db                      # 数据库文件
│   ├── font
│   └── js
├── docs
├── resources                   // 资源文件（实际使用）
│   ├── characters
│   │   └── profile             # 角色头像，在【米游社】、【UID】左上角被使用
│   ├── gacha
│   │   └── items               # 抽卡背景，在【十连】中被使用
│   ├── item                    # 一些零碎图片
│   ├── module                  # 游戏信息展示框图，在【米游社】、【UID】中被使用
│   └── Version2
│       ├── artifact            # 所有的圣遗物套图，在【圣遗物】中被使用
│       ├── character           # 角色立绘，在【角色】中被使用
│       ├── info
│       │   ├── docs            # 角色信息数据
│       │   ├── image           # 升级素材图片，在【角色】、【武器】中被使用
│       │   └── other           # 游戏信息展示框图，在【角色】、【武器】中被使用
│       ├── module              # 圣遗物展示框图
│       ├── slip
│       ├── weapon              # 武器立绘，在【武器】中被使用
│       └── wish
│           ├── character       # 角色抽卡图片，在【十连】中被使用
│           ├── config          # 角色和武器数据
│           └── weapon          # 武器抽卡图片，在【十连】中被使用
├── resources_custom            // 此目录组织和 resources 完全一致，会覆盖 resource 中的同路径资源
└── src
    ├── plugins                 # 插件
    ├── utils                   # 库
    └── views                   # Vue.js
```

## 插件开发

1. 在`src/plugins`目录下创建插件目录
2. 在`config/command.yml`中添加正则匹配
3. 如有需要，在`src/utils/init.js`中加载数据库

## 资源文件

### 资源目录

#### resources

此目录是实际使用的资源目录，其中有一个脚本`update.sh`，会做两件事。

1. 向原作者的 OSS 请求资源文件并按路径保存到此目录。
2. 复制`resources_custom`目录下的文件，覆盖到此目录中的对应路径。

> 更多信息请查看 `资源制作.md` 。

#### resources_custom

此项目制作的资源文件，应当按照目录组织存放到此处，会覆盖到`resources`目录下的对应路径。

## 数据库

本项目数据库简易封装了[lowDB](https://github.com/typicode/lowdb)。你也可以根据需要在`src/utils/database.js`中定义自己的方法。

### 导入

```js
import db from "../../utils/database.js";
```

### 初始化

初始化名称为 `name` 的数据库。如果数据库已存在，加载其数据；如果数据库不存在，创建空数据库。

`default` 默认设置为 `{ user: [] }` 。

```js
db.init(name: String, default?: Object);
```

> 在 src/utils/init.js 中使用，以便启动时初始化。

### 数据存在性

在数据库 `name` 中判断 `path` 是否存在。

```js
db.has(name: String, ...path);
```

> 对应 `lodash.hasIn` 。

### 写入磁盘

把数据库 `name` 的数据写入磁盘，一般无须手动调用。

```
db.write(name: String);
```

### 判断是否含有数据

在数据库 `name` 中的 `key` 对应的 Array 中，检测所有的索引 `index` 在是否包含值 `value` 。

```
db.includes(name: String, key: String, index: String, value: Any);
```

> 对应 `lodash.includes` 。

### 获取数据

> | `index` | 返回值 |
> | --- | --- |
> | `undefined` | `key` 对应的 Array  |
> | Object | `key` 对应的 Array 中，获取包含索引 `index` 的对象 |

`index` 默认为 `undefined` 。

```
db.get(name: String, key: String, index?: Object);
```

> 对应 `lodash.get` 和 `lodash.find` 。

### 写入数据

在数据库 `name` 中的 `key` 对应的 Array 中，插入一条数据 `data` 。

此方法自动调用 `db.write` 。

```
db.push(name: String, key: String, data: Object);
```

> 对应 `lodash.push` 。

### 更新数据

在数据库 `name` 中的 `key` 对应的 Array 中，将包含索引 `index` 的对象更新为 `data` 。

此方法自动调用 `db.write` 。

> 只更新 `data` 中包含的 pair ，不会修改其他数据。

```
db.update(name: String, key: String, index: Object, data: Object);
```

> 对应 `lodash.assign` 。

### 设置数据

把数据库 `name` 中的 `key` 对应的数据设置为 `data` 。

此方法自动调用 `db.write` 。

```
db.set(name: String, key: String, data: any);
```

> 对应 `lodash.set` 。
